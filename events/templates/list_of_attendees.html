{% load static %}
<!doctype html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="">
    <![endif]-->
<!--[if IE 7]>
    <html class="no-js lt-ie9 lt-ie8" lang="">
        <![endif]-->
<!--[if IE 8]>
        <html class="no-js lt-ie9" lang="">
            <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <script src="{% static 'js/vendor/modernizr-2.8.3-respond-1.4.2.min.js' %}"></script>
    <script type="text/javascript" language="javascript" src="//code.jquery.com/jquery-1.12.4.js">
    </script>
    <script type="text/javascript" language="javascript"
            src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js">
    </script>
    <script type="text/javascript" language="javascript"
            src="https://cdn.datatables.net/rowreorder/1.2.3/js/dataTables.rowReorder.min.js">
    </script>
    <script type="text/javascript" language="javascript"
            src="https://cdn.datatables.net/responsive/2.2.0/js/dataTables.responsive.min.js">
    </script>

    <script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>
</head>
<body>
<div class="gradient-bg">

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-2 col-xs-5">
                <div class="sub-logo">
                    <img src="{% static 'img/sub-logo.png' %}" width="100%"/>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="table-wrapper">
            <div class="tb-head row m0">
                <div class="col-md-2 col-sm-6">
                    <input type="text" class="form-control tb-search form-group" id="seachDataTable"
                           placeholder="Search"/>
                </div>
                <div class="col-md-2 col-sm-6">
                    <select id="sortTable" class="form-control form-group" place>
                        <option value="" disabled selected>Select Table</option>
                        <option value="all">All</option>
                        {% for table in tables %}
                            <option value={{ table.table_name }}>
                                {{ table.table_name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="pull-right">
                    <button class="btn btn-tb " data-toggle="tooltip" data-placement="top" title="Print"><img
                            src="{% static 'img/print.png' %}"/></button>
                    <button class="btn btn-tb " data-toggle="tooltip" data-placement="top" title="Download"><img
                            src="{% static 'img/download.png' %}"/></button>

                </div>

            </div>
            <table id="user_lists" class="display nowrap" cellspacing="0" width="100%">
                <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th>Table</th>
                    <th>Attending Event</th>
                </tr>
                </thead>
                <tbody>
                <form method="post">
                    {% csrf_token %}
                    {% for users in registered_users %}
                        <tr>
                            <td></td>
                            <td>{{ users.event_user.first_name }} {{ users.event_user.last_name }}</td>
                            <td>{{ users.event_user.table }}</td>
                            <td>
                                <label class="switch">
                                    <input type="checkbox"
                                           {% if users.is_attending_event %}checked="checked"{% endif %}class="id_on_off"
                                           data-id="{{ users.id }}">
                                    <span class="slider round"></span>
                                </label>
                            </td>

                        </tr>
                    {% endfor %}
                </form>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">
    function openNav() {
        document.getElementById("myNav").style.height = "100%";
    }

    function closeNav() {
        document.getElementById("myNav").style.height = "0%";
    }

    $(document).ready(function () {

        var t = $('#user_lists').DataTable({
            "order": [[0, 'asc']],
            "paging": false,
            "info": false,
            // responsive: true,
            "scrollX": true,
            fixedHeader: true,
        });
        $("#user_lists_filter").hide();

    });

    $('#sortOption').on('change', function () {

        var table = $('#user_lists').DataTable();
        var order = table.order();

        selected_id = $("#sortOption option:selected").val();

        if (selected_id == '9') {
            table.order([12, 'desc']).draw();
        }
        else {
            table.order([selected_id, 'asc']).draw();
        }

    });

    $('#seachDataTable').keyup(function () {
        var table = $('#user_lists').DataTable();
        table.search($(this).val()).draw();
    });


    $('#sortTable').on('change', function () {
        var table = $('#user_lists').DataTable();
        var selected_table = $("#sortTable option:selected").val();
        if (selected_table == 'all') {
            location.reload();
        }
        else {
            regExSearch = '"' + selected_table + '"';
            console.log(regExSearch, 'ki')
            table.column(2).search(regExSearch).draw();
        }
    });


    $('.id_on_off').on('change', function () {

        var user_id = $(this).data("id");
        var isChecked = $(this).is(':checked');

        $.ajax({
            type: 'POST',
            url: "{% url 'adding_of_event_attendees' %}",
            data: {'user_id': user_id, 'isChecked': isChecked, csrfmiddlewaretoken: '{{ csrf_token }}'},
            dataType: 'json',
            success: function (data) {
            }
        });
    });


</script>
</body>
</html>